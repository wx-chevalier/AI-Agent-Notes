# 统一执行状态和业务状态

这一原则强调了清晰一致地理解 LLM 内部"执行状态"（LLM 认为正在发生的事情）和应用程序实际"业务状态"（基本事实）的重要性。任何差异都可能导致误解和错误。通过统一这些状态，我们确保 LLM 能够以准确且最新的信息运行，避免出现幻觉或无效操作。

![统一执行状态和业务状态](https://apframework.com/static/images/2025-07-08-12-Factor-Agents/image%204.png)

概念梳理：

- **执行状态**：当前步骤、下一步、等待状态、重试次数等。
- **业务状态**：代理工作流程中到目前为止发生的事情（例如 OpenAI 消息列表、工具调用和结果列表等）

这种方法有几个好处：

1. **简单**：所有状态的真相来源
2. **序列化**：线程可以轻松序列化/反序列化
3. **调试**：整个历史记录在一个地方可见
4. **灵活性**：只需添加新的事件类型即可轻松添加新状态
5. **恢复**：只需加载线程即可从任何点恢复
6. **分叉**：可以通过将线程的某些子集复制到新的上下文/状态 ID 中来随时分叉线程
7. **人机界面和可观察性**：将线程转换为人类可读的 Markdown 或丰富的 Web 应用程序 UI

# **理解笔记**

构建 Agent 过程中，构建上下文过程中，将执行状态和业务状态进行统一，一定程度上想起来规则引擎和状态机，构建规则，然后交给事件或者数据。

- 明确区分并统一 LLM 的"执行状态"与应用的"业务状态"，避免信息不一致导致的误判。
- 为每个状态变更建立可追溯日志，提升系统可观测性和可维护性。
