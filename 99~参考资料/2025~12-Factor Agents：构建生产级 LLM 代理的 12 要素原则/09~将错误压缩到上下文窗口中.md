# 将错误压缩到上下文窗口中

当 LLM 驱动的应用发生错误时，应向 LLM 提供简明、相关的故障信息。本原则建议将错误详情以结构化方式压缩进上下文窗口，让 LLM 更好地理解问题，并可能建议恢复策略或替代方案。这样可避免直接传递冗长原始日志，防止模型困惑。

![Compact Errors into Context window](https://apframework.com/static/images/2025-07-08-12-Factor-Agents/image%209.png)

这一点虽短，但很重要。代理的优势之一是"自我修复"——对于短任务，LLM 可能会调用失败的工具。优秀的 LLM 能很好地读取错误消息或堆栈跟踪，并判断后续工具调用需要如何调整。

这样做的好处：

1. **自我修复**：LLM 能读取错误消息并找出后续工具调用的改进点
2. **持久**：即使工具调用失败，代理仍可继续运行

# **理解笔记**

构建 Agent 过程中，智能错误处理机制是构建可靠 AI 系统的关键组成部分。

- 错误信息应结构化、简明地反馈给 LLM，避免冗长日志导致模型困惑。
- 为常见错误类型设计标准化摘要模板，便于 LLM 理解和自我修复。
- 记录每次错误及其处理过程，持续优化错误处理策略。
